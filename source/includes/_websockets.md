
# Websockets

In order to communicate with websockets, you must follow these requirements:

* Use a [socket.io](http://socket.io) API wrapper (or an alternative if available):

  - [Node.js](https://github.com/Automattic/socket.io-client)
  - [Ruby](https://github.com/lyondhill/socket.io-ruby-client)
  - [Python](https://pypi.python.org/pypi/socketIO-client)
  - [Java](https://github.com/Gottox/socket.io-java-client)
  - [Perl](https://metacpan.org/pod/AnyEvent::PocketIO::Client)

* Retrieve a JSON Web Token ("JWT") to be passed as `token` in the request query object

* Bind and/or emit events as necessary


## Websocket Events

> Examples using client-side JavaScript (through use of jQuery and socket.io):

* [Client-side JavaScript JSFiddle Example Template](http://jsfiddle.net/Lokqp2os/)

#### Bindable Events

Name | Arguments | Description
---- | --------- | -----------
connect | callback\* | Connect to websockets
disconnect | callback\* | Disconnect from websockets
error | callback | Error from websocket connection
data | callback | Response from endpoint currently subscribed to (contains the following fields: `params`, `path`, `results`, and `timestamp`)
subscribe | name, options, callback\* | Subscribe to an endpoint
unsubscribe | name, options, callback\* | Unsubscribe from an endpoint

\* indicates callback function returns a param of `err` (e.g. `callback(err)`), and `err` will be null if successful or will contain an error message if unsuccessful

### Event Arguments

Argument | Type | Description | Required
-------- | ---- | ----------- | --------
name | String | Name of the event | Yes
options | Object | Options to pass to the event | Yes
callback | Function | Returns an error object (if any) | No

#### options

Parameter | Description | Required | Default
--------- | ----------- | -------- | -------
path | Endpoint path (e.g. "/real-time/crowd-sentiment") | yes | none
params | Object of parameters to pass to endpoint (e.g. `{ ticker: 'AAPL' }`) | yes | none


#### callback(err)

Returns an error object (if any)

## JSON Web Token ("JWT")

```shell
curl -X POST -u "sk_live_w3Q4bCJVB8xgyeIKJmTC4DS5:" "https://open.marketprophit.com/jwt"
```

> Returns response headers such as:

```bash
HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Access-Control-Allow-Headers: X-Requested-With
Access-Control-Allow-Methods: POST, GET, OPTIONS
Vary: Accept
Content-Type: application/json; charset=utf-8
Content-Length: 8540
set-cookie: igloo=s%3AlpeQBc22Jx3kF9fX1CCqNd824qm1GyEV.d%2B4BSvfzJuMI31Lewq7PmO2mIebJAyMN3D5qvOZNvVk; Path=/; Expires=Wed, 13 Aug 2014 10:07:55 GMT; HttpOnly
X-Response-Time: 55.15008ms
Date: Tue, 12 Aug 2014 10:07:55 GMT
Connection: keep-alive


```

> Returns response such as:

```json
{
  "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJfX3ZlcnNpb25zIjpbeyJjcmVhdGVkX2F0IjoiMjAxNC0wNy0yMlQxOTowNToxNy4wMDBaIiwidXBkYXRlZF9hdCI6IjIwMTQtMDctMjJUMTk6MDU6MTguMTgyWiIsImZ1bGxfZW1haWwiOiJCcmFuZG9uIEhvb2QgPGhvb2RicmFuZG9uQHlhaG9vLmNvbT4iLCJhcGkiOiJza19saXZlX3czUTRiQ0pWQjh4Z3llSUtKbVRDNERTNSIsInNhbHQiOiI4N2Q1OWRiOTkwODE3ODYzYTAzM2E3MDkzMjE4OWI0ZTc5MzE1NWZkODRhMzA3ZmNmZjZhOThlMzJjNWJhYzEyIiwiaGFzaCI6Ijg1YmIzMGQzMTllODg2ZmRhMDY3MGEzZTljMDhlOGVhMWJhYzEzNjQwOGQ5MjFjYzI1MzVhYmVhM2M0ZDY3MmQ2YzAzMjMwYTllNWY0MGZmY2RlNTkzMzZkNDYwMzZkMDk4NzczNGFhYTU4ZGQ1ZjAxMjkzZmFhMjAxYzdkY2FkMWViMGY2YzE3MzJkZTRkNmMzNjlmYjVhNGM2YmZiMjMxMGUxMzA2OWE0Zjg2OTFmNjI0Y2VlYWYyYjYyMjE5MGI2NDAzYzJhMWYwOWU4MjQwMjZlYzkxODM3OTU3MjUyYWNiZmRkZTNkYzQ2ZDQ3MThlZjExOTM4NWIzODVmOTNmNDA4ODI1NTI1MTUwZTNjNDA1M2FhOTYxYmRlMGY0MjIxZWY2Zjk2ZDVlMTM2Mzc4OWZlMzgzNWM3YjhmMjhiNGUzZGJiMzQ2OWVjNGZiY2FhZDBkMDU4NjJjMWQxZDQyNzFiYmFjZjk5Njg4MGVlNDgzMThkMTRiNmZmNzgwZDQwZjkyMjM0YjYwYzEwNmM0OTYwYjM1NmI1MGU3MDRkNmQ3Y2Q0NDM5Mjk4NjQ1YzUyNWRhZmYwNmZjYWExMjkxYjcyMjRjM2JjZTc3NWQ3OTZkNDAzY2IzNDEwYWUwNjViNmIzMjA2NDA4NjI5N2E3YWFmYjRjNmQzMmYxNzAwYTBhM2JkZGY5OTE3NDY0OWQwMDY5NDRhYmI1OWI0NDA1ODA3ZjJjNDBhM2UwNDk3Mjg0MWQ0YTdlZmNjMmY0NjQwNjk2MDQ2MzhiNGViMWYxNmVlZjIyZjQ2NGFkZDk2ODBhZTZkZTA5OGUwM2FmYmNmN2I3NTA2NTM5NDI2NWZhNTZhODI4MTJlNDkyMWNlN2IxMjczY2E1OTg3ZGM3NjIzZGQ4YWRhMTY3N2QxZTA4NjI1MWQ0ODViYzk3NjhjYzJhMzAxYWUxNDNmZDA4Njc4YjdiZjkwNTVkODZkNWIyZThlNDAwOGEwYjJlYTYyZDU3NTdiNjI2N2JmY2ZiNTNlYzdlYmM3MjZiYWM5ZGY5ZDc3ZTFjZTAzMjUzMTZhNDI5YWE0MTExODVkZDExODdmOTk3M2JlNDcwNTBkYjMxMGYyM2QzYTM4N2U3ODFjMDAzMDViZTI3YjI5YWM0M2I2YTU4MjM3MGYyNGVjYTVjNzVlZjI2MGIzZjRiYjgzMzdlMTNlMTk0YTRkN2RkYWRhODFiYzJmOGFkMTQxYmU3YmQ0ZGI4NzZjNmY3OTVkYzdhMzUwMWNjNDU3NGI4NmNhMGFlNDY4MDM2MzdkMzAxZTMxMWQxYTMzZmIxZWNjMmNlZmYxYzU4YTAzN2VjZTYyODI0NzkwYjU3MDU3YTciLCJlbWFpbCI6Imhvb2RicmFuZG9uQHlhaG9vLmNvbSIsIm5hbWUiOiJCcmFuZG9uIEhvb2QiLCJjb21wYW55IjoiTWFya2V0IFByb3BoaXQiLCJtZXNzYWdlIjoiKioqIFRoaXMgaXMgTmljayBCYXVnaCBqdXN0IHRlc3Rpbmcgb3V0IHRoaXMgYW5kIHNldHRpbmcgdXAgQnJhbmRvbiB3aXRoIGFuIGFjY291bnQgZm9yIHRlc3RpbmcgdG9kYXkuICoqKiIsIl9pZCI6IjUzY2ViNWVkODY4MThhMTk3YmE4ZWMyMCIsInRpY2tlcnMiOltdLCJ0cmlhbCI6dHJ1ZSwiYWN0aXZlIjpmYWxzZSwiZ3JvdXAiOiJ1c2VyIiwib2JqZWN0IjoidXNlciIsImlkIjoiNTNjZWI1ZWQ4NjgxOGExOTdiYThlYzIwIiwiX192IjowfSx7ImlkIjoiNTNjZWI1ZWQ4NjgxOGExOTdiYThlYzIwIiwib2JqZWN0IjoidXNlciIsImdyb3VwIjoiYWRtaW4iLCJhY3RpdmUiOnRydWUsInRyaWFsIjp0cnVlLCJ0aWNrZXJzIjpbXSwiX192IjoxLCJfaWQiOiI1M2NlYjVlZDg2ODE4YTE5N2JhOGVjMjAiLCJtZXNzYWdlIjoiKioqIFRoaXMgaXMgTmljayBCYXVnaCBqdXN0IHRlc3Rpbmcgb3V0IHRoaXMgYW5kIHNldHRpbmcgdXAgQnJhbmRvbiB3aXRoIGFuIGFjY291bnQgZm9yIHRlc3RpbmcgdG9kYXkuICoqKiIsImNvbXBhbnkiOiJNYXJrZXQgUHJvcGhpdCIsIm5hbWUiOiJCcmFuZG9uIEhvb2QiLCJlbWFpbCI6Imhvb2RicmFuZG9uQHlhaG9vLmNvbSIsImhhc2giOiI4NWJiMzBkMzE5ZTg4NmZkYTA2NzBhM2U5YzA4ZThlYTFiYWMxMzY0MDhkOTIxY2MyNTM1YWJlYTNjNGQ2NzJkNmMwMzIzMGE5ZTVmNDBmZmNkZTU5MzM2ZDQ2MDM2ZDA5ODc3MzRhYWE1OGRkNWYwMTI5M2ZhYTIwMWM3ZGNhZDFlYjBmNmMxNzMyZGU0ZDZjMzY5ZmI1YTRjNmJmYjIzMTBlMTMwNjlhNGY4NjkxZjYyNGNlZWFmMmI2MjIxOTBiNjQwM2MyYTFmMDllODI0MDI2ZWM5MTgzNzk1NzI1MmFjYmZkZGUzZGM0NmQ0NzE4ZWYxMTkzODViMzg1ZjkzZjQwODgyNTUyNTE1MGUzYzQwNTNhYTk2MWJkZTBmNDIyMWVmNmY5NmQ1ZTEzNjM3ODlmZTM4MzVjN2I4ZjI4YjRlM2RiYjM0NjllYzRmYmNhYWQwZDA1ODYyYzFkMWQ0MjcxYmJhY2Y5OTY4ODBlZTQ4MzE4ZDE0YjZmZjc4MGQ0MGY5MjIzNGI2MGMxMDZjNDk2MGIzNTZiNTBlNzA0ZDZkN2NkNDQzOTI5ODY0NWM1MjVkYWZmMDZmY2FhMTI5MWI3MjI0YzNiY2U3NzVkNzk2ZDQwM2NiMzQxMGFlMDY1YjZiMzIwNjQwODYyOTdhN2FhZmI0YzZkMzJmMTcwMGEwYTNiZGRmOTkxNzQ2NDlkMDA2OTQ0YWJiNTliNDQwNTgwN2YyYzQwYTNlMDQ5NzI4NDFkNGE3ZWZjYzJmNDY0MDY5NjA0NjM4YjRlYjFmMTZlZWYyMmY0NjRhZGQ5NjgwYWU2ZGUwOThlMDNhZmJjZjdiNzUwNjUzOTQyNjVmYTU2YTgyODEyZTQ5MjFjZTdiMTI3M2NhNTk4N2RjNzYyM2RkOGFkYTE2NzdkMWUwODYyNTFkNDg1YmM5NzY4Y2MyYTMwMWFlMTQzZmQwODY3OGI3YmY5MDU1ZDg2ZDViMmU4ZTQwMDhhMGIyZWE2MmQ1NzU3YjYyNjdiZmNmYjUzZWM3ZWJjNzI2YmFjOWRmOWQ3N2UxY2UwMzI1MzE2YTQyOWFhNDExMTg1ZGQxMTg3Zjk5NzNiZTQ3MDUwZGIzMTBmMjNkM2EzODdlNzgxYzAwMzA1YmUyN2IyOWFjNDNiNmE1ODIzNzBmMjRlY2E1Yzc1ZWYyNjBiM2Y0YmI4MzM3ZTEzZTE5NGE0ZDdkZGFkYTgxYmMyZjhhZDE0MWJlN2JkNGRiODc2YzZmNzk1ZGM3YTM1MDFjYzQ1NzRiODZjYTBhZTQ2ODAzNjM3ZDMwMWUzMTFkMWEzM2ZiMWVjYzJjZWZmMWM1OGEwMzdlY2U2MjgyNDc5MGI1NzA1N2E3Iiwic2FsdCI6Ijg3ZDU5ZGI5OTA4MTc4NjNhMDMzYTcwOTMyMTg5YjRlNzkzMTU1ZmQ4NGEzMDdmY2ZmNmE5OGUzMmM1YmFjMTIiLCJhcGkiOiJza19saXZlX3czUTRiQ0pWQjh4Z3llSUtKbVRDNERTNSIsImZ1bGxfZW1haWwiOiJCcmFuZG9uIEhvb2QgPGhvb2RicmFuZG9uQHlhaG9vLmNvbT4iLCJ1cGRhdGVkX2F0IjoiMjAxNC0wNy0yMlQxOTowNToxNy4wMDBaIiwiY3JlYXRlZF9hdCI6IjIwMTQtMDctMjJUMTk6MDU6MTcuMDAwWiIsInRyaWFsX2VuZF9hdCI6IjIwMTUtMTItMDFUMDU6MDA6MDAuMDAwWiJ9XSwiYXBpIjoic2tfbGl2ZV93M1E0YkNKVkI4eGd5ZUlLSm1UQzREUzUiLCJjb21wYW55IjoiTWFya2V0IFByb3BoaXQiLCJjcmVhdGVkX2F0IjoiMjAxNC0wNy0yMlQxOTowNToxNy4wMDBaIiwiY3VzdG9tZXJfbnVtYmVyIjoiMTQ3MDI2MzcwMyIsImVtYWlsIjoiaG9vZGJyYW5kb25AeWFob28uY29tIiwiZnVsbF9lbWFpbCI6IkJyYW5kb24gSG9vZCA8aG9vZGJyYW5kb25AeWFob28uY29tPiIsImZ1bGxfbmFtZSI6IkJyYW5kb24gSG9vZCIsIm1lc3NhZ2UiOiIqKiogVGhpcyBpcyBOaWNrIEJhdWdoIGp1c3QgdGVzdGluZyBvdXQgdGhpcyBhbmQgc2V0dGluZyB1cCBCcmFuZG9uIHdpdGggYW4gYWNjb3VudCBmb3IgdGVzdGluZyB0b2RheS4gKioqIiwibmFtZSI6IkJyYW5kb24iLCJwaG9uZSI6IjEyMy00NTYtNzg5MCIsInJlc2V0X2F0IjoiMjAxNC0wNy0zMFQwMDoxOTo1Ni4wMDBaIiwicmVzZXRfdG9rZW4iOiIiLCJzdXJuYW1lIjoiSG9vZCIsInRyaWFsX2VuZF9hdCI6IjIwMTUtMTItMDFUMDU6MDA6MDAuMDAwWiIsInVwZGF0ZWRfYXQiOiIyMDE0LTA3LTIyVDE5OjA1OjE3LjAwMFoiLCJyYXRlX2xpbWl0X292ZXJhZ2VfYW1vdW50IjowLCJyYXRlX2xpbWl0X292ZXJhZ2VfaW50ZXJ2YWwiOjAsImJpbGxpbmdfYW1vdW50X3Blcl9mcmVxdWVuY3kiOjAsImJpbGxpbmdfZnJlcXVlbmN5IjoiIiwiYmlsbGluZ19pbnRlcnZhbCI6IiIsImVuZHBvaW50X3BhdGhzIjpbIi9oaXN0b3JpY2FsL2Nyb3dkLXNlbnRpbWVudC1tb3ZpbmctYXZlcmFnZSIsIi9oaXN0b3JpY2FsL2Nyb3dkLXNlbnRpbWVudC16LXNjb3JlLW1vdmluZy1hdmVyYWdlIiwiL2hpc3RvcmljYWwvY3Jvd2Qtc2VudGltZW50LXotc2NvcmUiLCIvaGlzdG9yaWNhbC9jcm93ZC1zZW50aW1lbnQiLCIvaGlzdG9yaWNhbC9kYWlseS1jcm93ZC1zZW50aW1lbnQtbW92aW5nLWF2ZXJhZ2UiLCIvaGlzdG9yaWNhbC9kYWlseS1jcm93ZC1zZW50aW1lbnQtei1zY29yZS1tb3ZpbmctYXZlcmFnZSIsIi9oaXN0b3JpY2FsL2RhaWx5LWNyb3dkLXNlbnRpbWVudC16LXNjb3JlIiwiL2hpc3RvcmljYWwvZGFpbHktY3Jvd2Qtc2VudGltZW50IiwiL2hpc3RvcmljYWwvZGFpbHktbWFya2V0LXByb3BoaXQtc2VudGltZW50LW1vdmluZy1hdmVyYWdlIiwiL2hpc3RvcmljYWwvZGFpbHktbWFya2V0LXByb3BoaXQtc2VudGltZW50LXotc2NvcmUtbW92aW5nLWF2ZXJhZ2UiLCIvaGlzdG9yaWNhbC9kYWlseS1tYXJrZXQtcHJvcGhpdC1zZW50aW1lbnQtei1zY29yZSIsIi9oaXN0b3JpY2FsL2RhaWx5LW1hcmtldC1wcm9waGl0LXNlbnRpbWVudCIsIi9oaXN0b3JpY2FsL2RhaWx5LXR3ZWV0LWJ1enoiLCIvaGlzdG9yaWNhbC9kYWlseS10d2VldC12b2x1bWUiLCIvaGlzdG9yaWNhbC9kYWlseS11c2VyLXNjb3Jlcy1ieS11c2VyIiwiL2hpc3RvcmljYWwvbWFya2V0LXByb3BoaXQtc2VudGltZW50LW1vdmluZy1hdmVyYWdlIiwiL2hpc3RvcmljYWwvbWFya2V0LXByb3BoaXQtc2VudGltZW50LXotc2NvcmUtbW92aW5nLWF2ZXJhZ2UiLCIvaGlzdG9yaWNhbC9tYXJrZXQtcHJvcGhpdC1zZW50aW1lbnQtei1zY29yZSIsIi9oaXN0b3JpY2FsL21hcmtldC1wcm9waGl0LXNlbnRpbWVudCIsIi9oaXN0b3JpY2FsL3NlY3Rvci1zcGVjaWZpYy11c2VyLXJldHVybnMtYnktc2VjdG9yIiwiL2hpc3RvcmljYWwvc2VjdG9yLXNwZWNpZmljLXVzZXItcmV0dXJucy1ieS11c2VyIiwiL2hpc3RvcmljYWwvc2VjdG9yLXNwZWNpZmljLXVzZXItcmV0dXJucyIsIi9oaXN0b3JpY2FsL3NlY3Rvci1zcGVjaWZpYy11c2VyLXNjb3Jlcy1ieS1zZWN0b3IiLCIvaGlzdG9yaWNhbC9zZWN0b3Itc3BlY2lmaWMtdXNlci1zY29yZXMtYnktdXNlciIsIi9oaXN0b3JpY2FsL3NlY3Rvci1zcGVjaWZpYy11c2VyLXNjb3JlcyIsIi9oaXN0b3JpY2FsL3RpY2tlci1zcGVjaWZpYy11c2VyLXJldHVybnMtYnktdGlja2VyIiwiL2hpc3RvcmljYWwvdGlja2VyLXNwZWNpZmljLXVzZXItcmV0dXJucy1ieS11c2VyIiwiL2hpc3RvcmljYWwvdGlja2VyLXNwZWNpZmljLXVzZXItcmV0dXJucyIsIi9oaXN0b3JpY2FsL3RpY2tlci1zcGVjaWZpYy11c2VyLXNjb3Jlcy1ieS10aWNrZXIiLCIvaGlzdG9yaWNhbC90aWNrZXItc3BlY2lmaWMtdXNlci1zY29yZXMtYnktdXNlciIsIi9oaXN0b3JpY2FsL3RpY2tlci1zcGVjaWZpYy11c2VyLXNjb3JlcyIsIi9oaXN0b3JpY2FsL3R3ZWV0LWJ1enoiLCIvaGlzdG9yaWNhbC90d2VldC12b2x1bWUiLCIvaGlzdG9yaWNhbC91c2VyLXNjb3Jlcy1sYXN0IiwiL2hpc3RvcmljYWwvdXNlci1zY29yZXMiLCIvaGlzdG9yaWNhbC91c2VyLXNlbnRpbWVudC1ieS10aWNrZXIiLCIvaGlzdG9yaWNhbC91c2VyLXNlbnRpbWVudC1ieS11c2VyIiwiL3JlYWwtdGltZS9jcm93ZC1zZW50aW1lbnQtbW92aW5nLWF2ZXJhZ2UiLCIvcmVhbC10aW1lL2Nyb3dkLXNlbnRpbWVudC16LXNjb3JlLW1vdmluZy1hdmVyYWdlIiwiL3JlYWwtdGltZS9jcm93ZC1zZW50aW1lbnQtei1zY29yZSIsIi9yZWFsLXRpbWUvY3Jvd2Qtc2VudGltZW50IiwiL3JlYWwtdGltZS9tYXJrZXQtcHJvcGhpdC1zZW50aW1lbnQtbW92aW5nLWF2ZXJhZ2UiLCIvcmVhbC10aW1lL21hcmtldC1wcm9waGl0LXNlbnRpbWVudC16LXNjb3JlLW1vdmluZy1hdmVyYWdlIiwiL3JlYWwtdGltZS9tYXJrZXQtcHJvcGhpdC1zZW50aW1lbnQtei1zY29yZSIsIi9yZWFsLXRpbWUvbWFya2V0LXByb3BoaXQtc2VudGltZW50IiwiL3JlYWwtdGltZS90d2VldC1idXp6IiwiL3JlYWwtdGltZS90d2VldC12b2x1bWUiLCIvcmVhbC10aW1lL3VzZXItc2VudGltZW50LWxhc3QtbWludXRlIiwiL3JlYWwtdGltZS91c2VyLXNlbnRpbWVudCJdLCJ0aWNrZXJzIjpbXSwic3RyZWFtaW5nX2FjY2VzcyI6ZmFsc2UsInJhdGVfbGltaXRfY291bnQiOjUzLCJyYXRlX2xpbWl0IjowLCJ0cmlhbCI6dHJ1ZSwiYWN0aXZlIjp0cnVlLCJncm91cCI6ImFkbWluIiwib2JqZWN0IjoidXNlciIsImlkIjoiNTNjZWI1ZWQ4NjgxOGExOTdiYThlYzIwIn0.BpcwlgZtjjt-eO9_9AD9nBrb_o-OyM7vw4PBZGowVLk"
}
```

>  JSON Web Token (JWT) is a means of representing claims to be transferred between two parties.  The claims in a JWT are encoded as a JSON object that is digitally signed or MACed using JSON Web Signature (JWS) and/or encrypted using JSON Web Encryption (JWE). &ndash; [IETF][ietf]

In order to communicate over websockets with Market Prophit API endpoints, you must pass a valid JWT.

The flow of communication with the Market Prophit websocket server is as follows:

1. Retrieve a JWT using your secret API key (do not expose your secret API key, set up your own `/jwt` route on your server and send a server-side request to our `/jwt` route with your secret key &ndash; basically create a proxy route)
2. Pass the JWT as part of the request query object while connecting to the Market Prophit websocket server as the param `token`.
3. Every (5) hours from when the JWT was generated, re-generate a new JWT since the previous expires

[ietf]: http://tools.ietf.org/html/draft-jones-json-web-token-10

### HTTP Request

`POST https://open.marketprophit.com/jwt`
